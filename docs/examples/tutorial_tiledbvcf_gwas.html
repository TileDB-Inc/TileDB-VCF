<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GWAS with the 1000 Genomes TileDB-VCF Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../documentation/ingestion/cli.html" rel="next">
<link href="../examples/tutorial_tiledbvcf_allele_frequencies.html" rel="prev">
<link href="../documentation/assets/tiledb.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../quarto-materials/tiledb.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../quarto-materials/tiledb-logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://tiledb.com" rel="" target="">
 <span class="menu-text">Home page</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cloud.tiledb.com/auth/login" rel="" target="">
 <span class="menu-text">Login</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tiledb.com/contact" rel="" target="">
 <span class="menu-text">Contact us</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/TileDB-Inc/TileDB-VCF" rel="" target="">
 <span class="menu-text">Repo</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../examples/tutorial_tiledbvcf_basics.html">Examples</a></li><li class="breadcrumb-item"><a href="../examples/tutorial_tiledbvcf_gwas.html">GWAS with the 1000 Genomes TileDB-VCF Dataset</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TileDB-VCF</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/tutorial_tiledbvcf_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TileDB-VCF Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/tutorial_tiledbvcf_allele_frequencies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TileDB-VCF Allele Frequencies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/tutorial_tiledbvcf_gwas.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">GWAS with the 1000 Genomes TileDB-VCF Dataset</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Ingestion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/ingestion/cli.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/ingestion/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/ingestion/distributed-ingestion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributed Ingestion</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">API Reference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/api-reference/cli.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">How To</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/create-a-dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create a Dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/export-to-vcf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Export to VCF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/handle-large-queries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Handle Large Queries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/ingest-samples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ingest Samples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/perform-distributed-queries-with-tiledb-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Perform Distributed Queries with TileDB-Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/perform-distributed-queries-with-dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Perform Distributed Queries with Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/perform-distributed-queries-with-spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Perform Distributed Queries with Spark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/read-from-the-dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Read from the Dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/how-to/work-with-cloud-object-stores.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Work with Cloud Object Stores</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/the-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/data-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Model</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  </ul></li>
  <li><a href="#sample-phenotypes" id="toc-sample-phenotypes" class="nav-link" data-scroll-target="#sample-phenotypes">Sample Phenotypes</a></li>
  <li><a href="#scaling-gwas-with-serverless-udfs" id="toc-scaling-gwas-with-serverless-udfs" class="nav-link" data-scroll-target="#scaling-gwas-with-serverless-udfs">Scaling GWAS with Serverless UDFs</a></li>
  <li><a href="#binned-genomic-regions" id="toc-binned-genomic-regions" class="nav-link" data-scroll-target="#binned-genomic-regions">Binned Genomic Regions</a></li>
  <li><a href="#gwas-steps" id="toc-gwas-steps" class="nav-link" data-scroll-target="#gwas-steps">GWAS Steps</a>
  <ul class="collapse">
  <li><a href="#vcf_snp_query" id="toc-vcf_snp_query" class="nav-link" data-scroll-target="#vcf_snp_query">1. <code>vcf_snp_query()</code></a></li>
  <li><a href="#filter_variants" id="toc-filter_variants" class="nav-link" data-scroll-target="#filter_variants">2. <code>filter_variants()</code></a></li>
  <li><a href="#calc_gwas" id="toc-calc_gwas" class="nav-link" data-scroll-target="#calc_gwas">3. <code>calc_gwas()</code></a></li>
  <li><a href="#combine_results" id="toc-combine_results" class="nav-link" data-scroll-target="#combine_results">4. <code>combine_results()</code></a></li>
  </ul></li>
  <li><a href="#construct-udf-based-task-graph" id="toc-construct-udf-based-task-graph" class="nav-link" data-scroll-target="#construct-udf-based-task-graph">Construct UDF-based Task Graph</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/TileDB-Inc/TileDB-VCF/blob/main/examples/tutorial_tiledbvcf_gwas.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/TileDB-Inc/TileDB-VCF/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GWAS with the 1000 Genomes TileDB-VCF Dataset</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this notebook we’ll perform a rudimentary genome-wide association study using the 1000 Genomes (1KG) dataset. The goal of this tutorial is to demonstrate the mechanics of performing genome-wide analyses using variant call data stored with TileDB-VCF and how such analyses can be easily scaled using TileDB Cloud’s serverless computation platform.</p>
<p>To get started we’ll load a few required packages and define several variables that we’ll refer to throughout the notebook.</p>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:28.812417Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:28.812322Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:29.409835Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:29.409326Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tiledb</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tiledbvcf</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tiledb.cloud</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tiledb.cloud.compute <span class="im">import</span> Delayed</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"tileDB-vcf v</span><span class="sc">{</span>tiledbvcf<span class="sc">.</span>version<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"tileDB-cloud v</span><span class="sc">{</span>tiledb<span class="sc">.</span>cloud<span class="sc">.</span>version<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tileDB-vcf v0.22.1.dev27
tileDB-cloud v0.10.0</code></pre>
</div>
</div>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:29.428217Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:29.428027Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:29.430739Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:29.430127Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>genome <span class="op">=</span> <span class="st">"hg19"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>array_uri <span class="op">=</span> <span class="st">"tiledb://TileDB-Inc/vcf-1kg-phase3"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sample_array <span class="op">=</span> <span class="st">"tiledb://TileDB-Inc/vcf-1kg-sample-metadata"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># vcf attributes to include</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>attrs <span class="op">=</span> [</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sample_name"</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"contig"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pos_start"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pos_end"</span>, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fmt_GT"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:29.432310Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:29.432211Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:29.542380Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:29.541744Z&quot;}" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>tiledbvcf stat <span class="op">--</span>uri tiledb:<span class="op">//</span>TileDB<span class="op">-</span>Inc<span class="op">/</span>vcf<span class="op">-</span><span class="dv">1</span><span class="er">kg</span><span class="op">-</span>phase3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/bin/bash: line 1: tiledbvcf: command not found</code></pre>
</div>
</div>
</section>
</section>
<section id="sample-phenotypes" class="level1">
<h1>Sample Phenotypes</h1>
<p>Because no phenotypic data was collected for the 1KG dataset, we’ll create a dummy trait indicating whether or not a sample identified as female.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:29.544148Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:29.544043Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:31.766814Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:31.766320Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tiledb.<span class="bu">open</span>(sample_array) <span class="im">as</span> A:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    df_samples <span class="op">=</span> A.df[:]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy trait</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df_samples[<span class="st">"is_female"</span>] <span class="op">=</span> df_samples.gender <span class="op">==</span> <span class="st">"female"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">super_pop</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">is_female</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sampleuid</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">HG00096</td>
<td>GBR</td>
<td>EUR</td>
<td>male</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HG00097</td>
<td>GBR</td>
<td>EUR</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HG00099</td>
<td>GBR</td>
<td>EUR</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HG00100</td>
<td>GBR</td>
<td>EUR</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HG00101</td>
<td>GBR</td>
<td>EUR</td>
<td>male</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NA21137</td>
<td>GIH</td>
<td>SAS</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NA21141</td>
<td>GIH</td>
<td>SAS</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NA21142</td>
<td>GIH</td>
<td>SAS</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NA21143</td>
<td>GIH</td>
<td>SAS</td>
<td>female</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">NA21144</td>
<td>GIH</td>
<td>SAS</td>
<td>female</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>2504 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="scaling-gwas-with-serverless-udfs" class="level1">
<h1>Scaling GWAS with Serverless UDFs</h1>
<p>We can parallelize the association analysis by dividing the genome into disjoint partitions that are queried, filtered, and analyzed by separate serverless nodes.</p>
</section>
<section id="binned-genomic-regions" class="level1">
<h1>Binned Genomic Regions</h1>
<p>To get started we’ll use the <a href="https://cloud.tiledb.com/udfs/details/aaronwolen/genome_windows"><code>genome_windows</code></a> UDF to divide a genome into windows (i.e., bins) and return a list of regions in the <code>chr:start-end</code> format that <code>tiledbvcf</code> expects.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:31.768487Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:31.768384Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:34.972169Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:34.971340Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bed_regions <span class="op">=</span> tiledb.cloud.udf.<span class="bu">exec</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    func <span class="op">=</span> <span class="st">"aaronwolen/genome_windows"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    genome <span class="op">=</span> <span class="st">"hg19"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> <span class="dv">100000</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    style <span class="op">=</span> <span class="st">"NCBI"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For now we’ll filter this list to include only regions from chromosome 20.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:34.974559Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:34.974430Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:34.978901Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:34.978633Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bed_regions <span class="op">=</span> [r <span class="cf">for</span> r <span class="kw">in</span> bed_regions <span class="cf">if</span> r.startswith(<span class="st">"20:"</span>)]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(bed_regions)<span class="sc">}</span><span class="ss"> total regions"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bed_regions[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>631 total regions</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>['20:1-100000',
 '20:100001-200000',
 '20:200001-300000',
 '20:300001-400000',
 '20:400001-500000']</code></pre>
</div>
</div>
</section>
<section id="gwas-steps" class="level1">
<h1>GWAS Steps</h1>
<p>Each of the individual tasks we performed above must be wrapped in functions so they can be packaged as UDFs and shipped to the serverless compute infrastructure. We’ll define two separate functions:</p>
<section id="vcf_snp_query" class="level2">
<h2 class="anchored" data-anchor-id="vcf_snp_query">1. <code>vcf_snp_query()</code></h2>
<ul>
<li>queries a specified window from the genome</li>
<li>filters the sites based on the defined criteria</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:34.980432Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:34.980344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:44.470164Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:44.469694Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> tiledb.cloud.udf.<span class="bu">exec</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    func <span class="op">=</span> <span class="st">"aaronwolen/vcf_snp_query"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    uri <span class="op">=</span> array_uri,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    attrs <span class="op">=</span> attrs,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    regions <span class="op">=</span> bed_regions[:<span class="dv">2</span>],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>res.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 94.3 ms, sys: 62.6 ms, total: 157 ms
Wall time: 9.48 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sample_name</th>
<th data-quarto-table-cell-role="th">contig</th>
<th data-quarto-table-cell-role="th">pos_start</th>
<th data-quarto-table-cell-role="th">pos_end</th>
<th data-quarto-table-cell-role="th">fmt_GT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>HG00097</td>
<td>20</td>
<td>60828</td>
<td>60828</td>
<td>[0, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>HG00101</td>
<td>20</td>
<td>61098</td>
<td>61098</td>
<td>[0, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>HG00103</td>
<td>20</td>
<td>61098</td>
<td>61098</td>
<td>[1, 0]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>HG00109</td>
<td>20</td>
<td>61098</td>
<td>61098</td>
<td>[0, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>HG00111</td>
<td>20</td>
<td>61098</td>
<td>61098</td>
<td>[0, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">577809</td>
<td>NA21142</td>
<td>20</td>
<td>195696</td>
<td>195696</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">577810</td>
<td>NA21143</td>
<td>20</td>
<td>195696</td>
<td>195696</td>
<td>[1, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">577811</td>
<td>NA21144</td>
<td>20</td>
<td>195696</td>
<td>195696</td>
<td>[1, 1]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">577812</td>
<td>NA21142</td>
<td>20</td>
<td>196604</td>
<td>196604</td>
<td>[0, 1]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">577813</td>
<td>NA21144</td>
<td>20</td>
<td>196604</td>
<td>196604</td>
<td>[1, 0]</td>
</tr>
</tbody>
</table>

<p>551155 rows × 5 columns</p>
</div>
</div>
</div>
</section>
<section id="filter_variants" class="level2">
<h2 class="anchored" data-anchor-id="filter_variants">2. <a href="https://cloud.tiledb.com/udfs/details/aaronwolen/filter_variants"><code>filter_variants()</code></a></h2>
<ul>
<li>calculates allele count and minor allele frequencies</li>
<li>optinally filters for variants using the <code>maf</code> threshold</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:44.471983Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:44.471882Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:33:52.171601Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:33:52.171197Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>res2 <span class="op">=</span> tiledb.cloud.udf.<span class="bu">exec</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    func <span class="op">=</span> <span class="st">"aaronwolen/filter_variants"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> res,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    maf <span class="op">=</span> (<span class="fl">0.05</span>, <span class="fl">0.95</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>res2.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 183 ms, sys: 108 ms, total: 292 ms
Wall time: 7.69 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sample_name</th>
<th data-quarto-table-cell-role="th">pos_end</th>
<th data-quarto-table-cell-role="th">fmt_GT</th>
<th data-quarto-table-cell-role="th">dose</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">contig</th>
<th data-quarto-table-cell-role="th">pos_start</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="11" data-quarto-table-cell-role="th" data-valign="top">20</td>
<td data-quarto-table-cell-role="th">61098</td>
<td>HG00101</td>
<td>61098</td>
<td>[0, 1]</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61098</td>
<td>HG00103</td>
<td>61098</td>
<td>[1, 0]</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61098</td>
<td>HG00109</td>
<td>61098</td>
<td>[0, 1]</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">61098</td>
<td>HG00111</td>
<td>61098</td>
<td>[0, 1]</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61098</td>
<td>HG00115</td>
<td>61098</td>
<td>[1, 0]</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">195696</td>
<td>NA21142</td>
<td>195696</td>
<td>[1, 1]</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">195696</td>
<td>NA21143</td>
<td>195696</td>
<td>[1, 1]</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">195696</td>
<td>NA21144</td>
<td>195696</td>
<td>[1, 1]</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">196604</td>
<td>NA21142</td>
<td>196604</td>
<td>[0, 1]</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">196604</td>
<td>NA21144</td>
<td>196604</td>
<td>[1, 0]</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>488449 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="calc_gwas" class="level2">
<h2 class="anchored" data-anchor-id="calc_gwas">3. <code>calc_gwas()</code></h2>
<p>Reshapes the Dataframe of variants into a variant by sample matrix and performs a chi-squared analysis on site for the included trait</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:33:52.173145Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:33:52.173043Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:34:01.843205Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:34:01.842902Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>res3 <span class="op">=</span> tiledb.cloud.udf.<span class="bu">exec</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    func <span class="op">=</span> <span class="st">"aaronwolen/calc_gwas"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> res2,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    trait <span class="op">=</span> df_samples.is_female,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>res3.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 90.5 ms, sys: 23 ms, total: 113 ms
Wall time: 9.66 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contig</th>
<th data-quarto-table-cell-role="th">pos_start</th>
<th data-quarto-table-cell-role="th">oddsratio</th>
<th data-quarto-table-cell-role="th">pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>20</td>
<td>61098</td>
<td>0.494083</td>
<td>0.482112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>20</td>
<td>61138</td>
<td>0.289018</td>
<td>0.590851</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>20</td>
<td>61795</td>
<td>0.068686</td>
<td>0.793260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>20</td>
<td>63231</td>
<td>0.851720</td>
<td>0.356066</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>20</td>
<td>63244</td>
<td>0.004420</td>
<td>0.946994</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">423</td>
<td>20</td>
<td>198965</td>
<td>0.150694</td>
<td>0.697873</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">424</td>
<td>20</td>
<td>198977</td>
<td>0.025577</td>
<td>0.872937</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">425</td>
<td>20</td>
<td>199078</td>
<td>0.000250</td>
<td>0.987379</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">426</td>
<td>20</td>
<td>199114</td>
<td>0.000250</td>
<td>0.987379</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">427</td>
<td>20</td>
<td>199986</td>
<td>0.000250</td>
<td>0.987379</td>
</tr>
</tbody>
</table>

<p>428 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="combine_results" class="level2">
<h2 class="anchored" data-anchor-id="combine_results">4. <code>combine_results()</code></h2>
<ul>
<li>creates a single dataframe containing individual results from each partition</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:34:01.844781Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:34:01.844672Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:34:01.846937Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:34:01.846680Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_results(dfs):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Combine GWAS Results</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param list of dataframes: Region-specific GWAS results to combine</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Input list contains </span><span class="sc">{</span><span class="bu">len</span>(dfs)<span class="sc">}</span><span class="ss"> Arrow tables"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> pa.concat_tables([x <span class="cf">for</span> x <span class="kw">in</span> dfs <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="construct-udf-based-task-graph" class="level1">
<h1>Construct UDF-based Task Graph</h1>
<p>To run the complete pipeline serverlessly we need to create Delayed versions of these functions with the appropriate parameters. For <code>query_region()</code> we need to create one delayed instance for each of the genomic regions to be queried in parallel.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:34:01.848604Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:34:01.848460Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:34:02.255171Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:34:02.254773Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nregions <span class="op">=</span> <span class="bu">len</span>(bed_regions[:<span class="dv">100</span>])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>nparts <span class="op">=</span> nregions <span class="op">//</span> <span class="dv">5</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Analyzing </span><span class="sc">{</span>nregions<span class="sc">}</span><span class="ss"> regions across </span><span class="sc">{</span>nparts<span class="sc">}</span><span class="ss"> partitions"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>delayed_queries <span class="op">=</span> []</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nparts):</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    delayed_queries.append(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        Delayed(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"aaronwolen/vcf_snp_query"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            result_format<span class="op">=</span>tiledb.cloud.UDFResultType.ARROW,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="ss">f"VCF SNP Query </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        )(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            uri<span class="op">=</span>array_uri,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            attrs<span class="op">=</span>attrs,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            regions<span class="op">=</span>bed_regions[:nregions],</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>            region_partition<span class="op">=</span>(i, nparts),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            memory_budget_mb<span class="op">=</span><span class="dv">1024</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>delayed_filters <span class="op">=</span> [</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    Delayed(<span class="st">"aaronwolen/filter_variants"</span>, name<span class="op">=</span><span class="ss">f"VCF Filter </span><span class="sc">{</span>i[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)(</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        df<span class="op">=</span>i[<span class="dv">1</span>], maf<span class="op">=</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">enumerate</span>(delayed_queries)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>delayed_gwas <span class="op">=</span> [</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    Delayed(<span class="st">"aaronwolen/calc_gwas"</span>, name<span class="op">=</span><span class="ss">f"VCF GWAS </span><span class="sc">{</span>i[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)(</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        df<span class="op">=</span>i[<span class="dv">1</span>], trait<span class="op">=</span>df_samples.is_female</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">enumerate</span>(delayed_filters)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>delayed_results <span class="op">=</span> Delayed(combine_results, local<span class="op">=</span><span class="va">True</span>)(delayed_gwas)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>delayed_results.visualize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analyzing 100 regions across 20 partitions</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0b91aae3f68d4535b1ae2d36fd3409c0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p>Finally, we can execute our distributed GWAS and collect the results.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:34:02.256963Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:34:02.256835Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:37:14.239635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:37:14.239088Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> delayed_results.compute(name<span class="op">=</span><span class="st">"GWAS Tutorial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Input list contains 20 Arrow tables
CPU times: user 18.4 s, sys: 11.7 s, total: 30.1 s
Wall time: 3min 11s</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:37:14.241325Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:37:14.241221Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:37:14.248410Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:37:14.248118Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>results.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">contig</th>
<th data-quarto-table-cell-role="th">pos_start</th>
<th data-quarto-table-cell-role="th">oddsratio</th>
<th data-quarto-table-cell-role="th">pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>20</td>
<td>61098</td>
<td>0.494083</td>
<td>0.482112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>20</td>
<td>61138</td>
<td>0.289018</td>
<td>0.590851</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>20</td>
<td>61795</td>
<td>0.068686</td>
<td>0.793260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>20</td>
<td>63231</td>
<td>0.851720</td>
<td>0.356066</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>20</td>
<td>63244</td>
<td>0.004420</td>
<td>0.946994</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30836</td>
<td>20</td>
<td>9999302</td>
<td>1.173945</td>
<td>0.278592</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30837</td>
<td>20</td>
<td>9999622</td>
<td>1.173945</td>
<td>0.278592</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30838</td>
<td>20</td>
<td>9999661</td>
<td>1.173945</td>
<td>0.278592</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30839</td>
<td>20</td>
<td>9999900</td>
<td>0.999755</td>
<td>0.317370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30840</td>
<td>20</td>
<td>9999996</td>
<td>0.261170</td>
<td>0.609317</td>
</tr>
</tbody>
</table>

<p>30841 rows × 4 columns</p>
</div>
</div>
</div>
<p>And no association test would be complete without a manhattan plot:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-04-30T22:37:14.250005Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-04-30T22:37:14.249871Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-04-30T22:37:14.429239Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-04-30T22:37:14.428834Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> results.to_pandas()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>results[<span class="st">"log_pvalue"</span>] <span class="op">=</span> <span class="op">-</span>np.log10(results.pvalue)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">16</span>, <span class="dv">3</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.scatterplot(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"pos_start"</span>, </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"log_pvalue"</span>, </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> results</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel <span class="op">=</span> <span class="st">"Chr 1 Position"</span>, ylabel <span class="op">=</span> <span class="st">"-log10 p-value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>[Text(0.5, 0, 'Chr 1 Position'), Text(0, 0.5, '-log10 p-value')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="tutorial_tiledbvcf_gwas_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Here we’ve demonstrated how genome-wide pipelines can be encapsulated as distinct tasks, distributed as UDFs, and easily deployed in parallel at scale.</p>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"0b91aae3f68d4535b1ae2d36fd3409c0":{"model_module":"jupyterlab-plotly","model_module_version":"^5.14.1","model_name":"FigureModel","state":{"_config":{"plotlyServerURL":"https://plot.ly"},"_data":[{"hoverinfo":"none","line":{"color":"#888","width":0.5},"mode":"lines","type":"scatter","uid":"3cfcce19-017b-4263-b647-acc2fcb7d061","x":[125.59,2054.6,null,119.59,125.59,null,93.592,119.59,null,482.59,2054.6,null,324.59,482.59,null,298.59,324.59,null,741.59,2054.6,null,529.59,741.59,null,503.59,529.59,null,951.59,2054.6,null,734.59,951.59,null,708.59,734.59,null,1136.6,2054.6,null,939.59,1136.6,null,913.59,939.59,null,1309.6,2054.6,null,1144.6,1309.6,null,1118.6,1144.6,null,1476.6,2054.6,null,1349.6,1476.6,null,1323.6,1349.6,null,1640.6,2054.6,null,1554.6,1640.6,null,1528.6,1554.6,null,1803.6,2054.6,null,1759.6,1803.6,null,1733.6,1759.6,null,1965.6,2054.6,null,1943.6,1965.6,null,1938.6,1943.6,null,2143.6,2054.6,null,2146.6,2143.6,null,2149.6,2146.6,null,2343.6,2054.6,null,2354.6,2343.6,null,2366.6,2354.6,null,2552.6,2054.6,null,2567.6,2552.6,null,2583.6,2567.6,null,2765.6,2054.6,null,2782.6,2765.6,null,2800.6,2782.6,null,2980.6,2054.6,null,2998.6,2980.6,null,3017.6,2998.6,null,3196.6,2054.6,null,3215.6,3196.6,null,3234.6,3215.6,null,3412.6,2054.6,null,3431.6,3412.6,null,3451.6,3431.6,null,3629.6,2054.6,null,3648.6,3629.6,null,3668.6,3648.6,null,3846.6,2054.6,null,3865.6,3846.6,null,3885.6,3865.6,null,4063.6,2054.6,null,4082.6,4063.6,null,4102.6,4082.6,null],"y":[90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null,90,18,null,162,90,null,234,162,null]},{"hoverinfo":"text","marker":{"color":["black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black","black"],"line":{"width":2},"size":15},"mode":"markers","text":["__main__.combine_results (j3ts) - Not Started","VCF GWAS 0 - Not Started","VCF Filter 0 - Not Started","VCF SNP Query 0 - Not Started","VCF GWAS 1 - Not Started","VCF Filter 1 - Not Started","VCF SNP Query 1 - Not Started","VCF GWAS 2 - Not Started","VCF Filter 2 - Not Started","VCF SNP Query 2 - Not Started","VCF GWAS 3 - Not Started","VCF Filter 3 - Not Started","VCF SNP Query 3 - Not Started","VCF GWAS 4 - Not Started","VCF Filter 4 - Not Started","VCF SNP Query 4 - Not Started","VCF GWAS 5 - Not Started","VCF Filter 5 - Not Started","VCF SNP Query 5 - Not Started","VCF GWAS 6 - Not Started","VCF Filter 6 - Not Started","VCF SNP Query 6 - Not Started","VCF GWAS 7 - Not Started","VCF Filter 7 - Not Started","VCF SNP Query 7 - Not Started","VCF GWAS 8 - Not Started","VCF Filter 8 - Not Started","VCF SNP Query 8 - Not Started","VCF GWAS 9 - Not Started","VCF Filter 9 - Not Started","VCF SNP Query 9 - Not Started","VCF GWAS 10 - Not Started","VCF Filter 10 - Not Started","VCF SNP Query 10 - Not Started","VCF GWAS 11 - Not Started","VCF Filter 11 - Not Started","VCF SNP Query 11 - Not Started","VCF GWAS 12 - Not Started","VCF Filter 12 - Not Started","VCF SNP Query 12 - Not Started","VCF GWAS 13 - Not Started","VCF Filter 13 - Not Started","VCF SNP Query 13 - Not Started","VCF GWAS 14 - Not Started","VCF Filter 14 - Not Started","VCF SNP Query 14 - Not Started","VCF GWAS 15 - Not Started","VCF Filter 15 - Not Started","VCF SNP Query 15 - Not Started","VCF GWAS 16 - Not Started","VCF Filter 16 - Not Started","VCF SNP Query 16 - Not Started","VCF GWAS 17 - Not Started","VCF Filter 17 - Not Started","VCF SNP Query 17 - Not Started","VCF GWAS 18 - Not Started","VCF Filter 18 - Not Started","VCF SNP Query 18 - Not Started","VCF GWAS 19 - Not Started","VCF Filter 19 - Not Started","VCF SNP Query 19 - Not Started"],"type":"scatter","uid":"864789db-708d-4b12-96e8-fe9d6e784fef","x":[2054.6,125.59,119.59,93.592,482.59,324.59,298.59,741.59,529.59,503.59,951.59,734.59,708.59,1136.6,939.59,913.59,1309.6,1144.6,1118.6,1476.6,1349.6,1323.6,1640.6,1554.6,1528.6,1803.6,1759.6,1733.6,1965.6,1943.6,1938.6,2143.6,2146.6,2149.6,2343.6,2354.6,2366.6,2552.6,2567.6,2583.6,2765.6,2782.6,2800.6,2980.6,2998.6,3017.6,3196.6,3215.6,3234.6,3412.6,3431.6,3451.6,3629.6,3648.6,3668.6,3846.6,3865.6,3885.6,4063.6,4082.6,4102.6],"y":[18,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234,90,162,234]}],"_dom_classes":[],"_js2py_layoutDelta":{},"_js2py_pointsCallback":{},"_js2py_relayout":{},"_js2py_restyle":{},"_js2py_traceDeltas":{},"_js2py_update":{},"_last_layout_edit_id":62,"_last_trace_edit_id":62,"_layout":{"annotations":[{"showarrow":true,"x":0.005,"xref":"paper","y":-0.002,"yref":"paper"}],"hovermode":"closest","margin":{"b":20,"l":5,"r":5,"t":40},"showlegend":false,"xaxis":{"showgrid":false,"showticklabels":false,"zeroline":false},"yaxis":{"showgrid":false,"showticklabels":false,"zeroline":false}},"_model_module":"jupyterlab-plotly","_model_module_version":"^5.14.1","_model_name":"FigureModel","_py2js_addTraces":{},"_py2js_animate":{},"_py2js_deleteTraces":{},"_py2js_moveTraces":{},"_py2js_relayout":null,"_py2js_removeLayoutProps":{},"_py2js_removeTraceProps":{},"_py2js_restyle":{},"_py2js_update":null,"_view_count":0,"_view_module":"jupyterlab-plotly","_view_module_version":"^5.14.1","_view_name":"FigureView","tabbable":null,"tooltip":null}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../examples/tutorial_tiledbvcf_allele_frequencies.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">TileDB-VCF Allele Frequencies</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../documentation/ingestion/cli.html" class="pagination-link">
        <span class="nav-page-text">CLI</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>